<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post 1 - CPro Review</title>

    <!-- Optional Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>

<h1>My Blog Post 1</h1>
<p>Welcome to my blog! Here you can leave ratings, subscribe to my newsletter, or contact me.</p>

<hr>

<!-- Star Ratings -->
<h2>Rate this post:</h2>
<div class="star-rating">
    <span data-value="1">⭐</span>
    <span data-value="2">⭐</span>
    <span data-value="3">⭐</span>
    <span data-value="4">⭐</span>
    <span data-value="5">⭐</span>
</div>
<p id="rating-msg"></p>

<hr>

<!-- Newsletter Subscription -->
<h2>Subscribe to my Newsletter:</h2>
<form id="newsletter-form">
    <input type="text" id="name" placeholder="Your Name" required class="form-control mb-2">
    <input type="email" id="email" placeholder="Your Email" required class="form-control mb-2">
    <button type="submit" class="btn btn-primary">Subscribe</button>
</form>
<p id="newsletter-msg"></p>

<hr>

<!-- Contact Form -->
<h2>Contact Me:</h2>
<form id="contact-form">
    <input type="text" id="contact-name" placeholder="Your Name" required class="form-control mb-2">
    <input type="email" id="contact-email" placeholder="Your Email" required class="form-control mb-2">
    <textarea id="contact-message" placeholder="Your Message" required class="form-control mb-2"></textarea>
    <button type="submit" class="btn btn-success">Send Message</button>
</form>
<p id="contact-msg"></p>

<hr>

<!-- Utterances Comments -->
<h2>Comments:</h2>
<div id="comments">
    <script src="https://utteranc.es/client.js"
        repo="YOUR_GITHUB_USERNAME/your-repo"
        issue-term="pathname"
        theme="github-light"
        crossorigin="anonymous"
        async>
    </script>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3.2.0/dist/email.min.js"></script>
<script>
    // ---------- Newsletter Subscription (Google Sheets + EmailJS) ----------
    document.getElementById('newsletter-form').addEventListener('submit', function(e){
        e.preventDefault();
        const name = document.getElementById('name').value;
        const email = document.getElementById('email').value;

        fetch('https://script.google.com/macros/s/AKfycbwGvCZuDpuV7T60mUMcePUt0SN5d7MUhQ9xQ3Lmmivj33lSKo6Csn9xv1IPhOOVT4li/exec', {
            method: 'POST',
            body: JSON.stringify({name: name, email: email})
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('newsletter-msg').textContent = "Subscribed successfully!";
            document.getElementById('newsletter-form').reset();

            emailjs.send('service_8fe6yij', 'template_wxvjwg9', {
                from_name: name,
                from_email: email,
                message: "New newsletter subscription"
            });
        })
        .catch(error => {
            document.getElementById('newsletter-msg').textContent = "Subscription failed. Try again.";
            console.error(error);
        });
    });

    // ---------- Star Ratings ----------
    const stars = document.querySelectorAll('.star-rating span');
    let currentRating = localStorage.getItem('post1-rating') || 0;

    function updateStars(rating) {
        stars.forEach(star => {
            star.classList.remove('selected');
            if (star.dataset.value <= rating) {
                star.classList.add('selected');
            }
        });
    }

    updateStars(currentRating);

    stars.forEach(star => {
        star.addEventListener('click', () => {
            currentRating = star.dataset.value;
            localStorage.setItem('post1-rating', currentRating);
            document.getElementById('rating-msg').textContent = `Thanks for rating: ${currentRating}⭐`;
            updateStars(currentRating);
        });
    });

    // ---------- Initialize EmailJS ----------
    (function(){ emailjs.init("Ow9sGUE6hSO-EpF_T"); })();

    // ---------- Contact Form ----------
    document.getElementById('contact-form').addEventListener('submit', function(e){
        e.preventDefault();
        const name = document.getElementById('contact-name').value;
        const email = document.getElementById('contact-email').value;
        const message = document.getElementById('contact-message').value;

        emailjs.send('service_8fe6yij', 'template_wxvjwg9', {
            from_name: name,
            from_email: email,
            message: message
        })
        .then(() => {
            document.getElementById('contact-msg').textContent = "Message sent!";
            document.getElementById('contact-form').reset();
        }, (err) => {
            document.getElementById('contact-msg').textContent = "Failed to send message.";
            console.error("EmailJS error:", err);
        });
    });
</script>
</body>
</html>
